# Migration `20200609211134-first`

This migration has been generated by Ignacio Carlos Monzalvo Milan at 6/9/2020, 9:11:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "BookingStatus" AS ENUM ('COMPLETED', 'CONFIRMED', 'PENDING', 'CANCELLED');

CREATE TYPE "UserType" AS ENUM ('ADMIN', 'USER', 'GUEST');

CREATE TYPE "Day" AS ENUM ('MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY', 'SUNDAY');

CREATE TABLE "public"."AvailabilityItem" (
"day" "Day" NOT NULL ,"employeeId" integer  NOT NULL ,"from" text  NOT NULL ,"id" SERIAL,"to" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."VacationsItem" (
"employeeId" integer  NOT NULL ,"from" text  NOT NULL ,"id" SERIAL,"to" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Booking" (
"branchId" integer  NOT NULL ,"clientEmail" text   ,"clientFamilyName" text   ,"clientId" integer   ,"clientName" text   ,"clientPhone" text   ,"employeeId" integer  NOT NULL ,"end" text  NOT NULL ,"id" SERIAL,"start" text  NOT NULL ,"status" "BookingStatus" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Employee" (
"familyName" text  NOT NULL ,"givenName" text  NOT NULL ,"id" SERIAL,"phone" text  NOT NULL ,"userId" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Service" (
"currency" text  NOT NULL ,"description" text  NOT NULL ,"duration" integer  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"price" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Branch" (
"address" text  NOT NULL ,"businessId" integer  NOT NULL ,"description" text  NOT NULL ,"email" text  NOT NULL ,"id" SERIAL,"image" text   ,"name" text  NOT NULL ,"phone" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Business" (
"email" text  NOT NULL ,"handle" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"ownerId" integer  NOT NULL ,"phone" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"email" text  NOT NULL ,"familyName" text  NOT NULL ,"givenName" text  NOT NULL ,"id" SERIAL,"name" text   ,"password" text  NOT NULL DEFAULT E'',"userName" text  NOT NULL ,"userType" "UserType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Post" (
"authorId" integer   ,"content" text   ,"id" SERIAL,"published" boolean  NOT NULL DEFAULT false,"title" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_BookingToService" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_EmployeeToService" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_BranchToEmployee" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_BranchToService" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE UNIQUE INDEX "Business.email" ON "public"."Business"("email")

CREATE UNIQUE INDEX "Business.phone" ON "public"."Business"("phone")

CREATE UNIQUE INDEX "Business_ownerId" ON "public"."Business"("ownerId")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "_BookingToService_AB_unique" ON "public"."_BookingToService"("A","B")

CREATE  INDEX "_BookingToService_B_index" ON "public"."_BookingToService"("B")

CREATE UNIQUE INDEX "_EmployeeToService_AB_unique" ON "public"."_EmployeeToService"("A","B")

CREATE  INDEX "_EmployeeToService_B_index" ON "public"."_EmployeeToService"("B")

CREATE UNIQUE INDEX "_BranchToEmployee_AB_unique" ON "public"."_BranchToEmployee"("A","B")

CREATE  INDEX "_BranchToEmployee_B_index" ON "public"."_BranchToEmployee"("B")

CREATE UNIQUE INDEX "_BranchToService_AB_unique" ON "public"."_BranchToService"("A","B")

CREATE  INDEX "_BranchToService_B_index" ON "public"."_BranchToService"("B")

ALTER TABLE "public"."AvailabilityItem" ADD FOREIGN KEY ("employeeId")REFERENCES "public"."Employee"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."VacationsItem" ADD FOREIGN KEY ("employeeId")REFERENCES "public"."Employee"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Booking" ADD FOREIGN KEY ("clientId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Booking" ADD FOREIGN KEY ("branchId")REFERENCES "public"."Branch"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Booking" ADD FOREIGN KEY ("employeeId")REFERENCES "public"."Employee"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Employee" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Branch" ADD FOREIGN KEY ("businessId")REFERENCES "public"."Business"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Business" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_BookingToService" ADD FOREIGN KEY ("A")REFERENCES "public"."Booking"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_BookingToService" ADD FOREIGN KEY ("B")REFERENCES "public"."Service"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_EmployeeToService" ADD FOREIGN KEY ("A")REFERENCES "public"."Employee"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_EmployeeToService" ADD FOREIGN KEY ("B")REFERENCES "public"."Service"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_BranchToEmployee" ADD FOREIGN KEY ("A")REFERENCES "public"."Branch"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_BranchToEmployee" ADD FOREIGN KEY ("B")REFERENCES "public"."Employee"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_BranchToService" ADD FOREIGN KEY ("A")REFERENCES "public"."Branch"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_BranchToService" ADD FOREIGN KEY ("B")REFERENCES "public"."Service"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200609211134-first
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,142 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = "postgresql://nacho:nacho@localhost:5432/agendable"
+}
+
+model AvailabilityItem {
+  id         Int      @default(autoincrement()) @id
+  day        Day
+  from       String
+  to         String
+  employee   Employee @relation(fields: [employeeId], references: [id])
+  employeeId Int
+}
+
+model VacationsItem {
+  id         Int      @default(autoincrement()) @id
+  from       String
+  to         String
+  employee   Employee @relation(fields: [employeeId], references: [id])
+  employeeId Int
+}
+
+model Booking {
+  id               Int           @default(autoincrement()) @id
+  start            String
+  end              String
+  status           BookingStatus
+  client           User?         @relation(fields: [clientId], references: [id])
+  clientId         Int?
+  branch           Branch        @relation(fields: [branchId], references: [id])
+  branchId         Int
+  services         Service[]
+  employee         Employee      @relation(fields: [employeeId], references: [id])
+  employeeId       Int
+  clientEmail      String?
+  clientPhone      String?
+  clientName       String?
+  clientFamilyName String?
+}
+
+enum BookingStatus {
+  COMPLETED
+  CONFIRMED
+  PENDING
+  CANCELLED
+}
+
+model Employee {
+  id           Int                @default(autoincrement()) @id
+  givenName    String
+  familyName   String
+  user         User?              @relation(fields: [userId], references: [id])
+  userId       Int?
+  phone        String
+  services     Service[]
+  branches     Branch[]
+  bookings     Booking[]
+  availability AvailabilityItem[]
+  vacations    VacationsItem[]
+}
+
+model Service {
+  id          Int        @default(autoincrement()) @id
+  name        String
+  price       Float
+  currency    String
+  duration    Int
+  branches    Branch[]
+  description String
+  employees   Employee[]
+  bookings    Booking[]
+}
+
+model Branch {
+  id          Int        @default(autoincrement()) @id
+  address     String
+  phone       String
+  email       String
+  name        String
+  description String
+  image       String?
+  business    Business   @relation(fields: [businessId], references: [id])
+  businessId  Int
+  employees   Employee[]
+  services    Service[]
+  bookings    Booking[]
+}
+
+model Business {
+  id       Int      @default(autoincrement()) @id
+  name     String
+  email    String   @unique
+  phone    String   @unique
+  owner    User     @relation(fields: [ownerId], references: [id])
+  ownerId  Int
+  handle   String
+  branches Branch[]
+}
+
+model User {
+  email      String     @unique
+  id         Int        @default(autoincrement()) @id
+  name       String?
+  password   String     @default("")
+  posts      Post[]
+  business   Business?
+  givenName  String
+  familyName String
+  userName   String
+  userType   UserType
+  bookings   Booking[]
+  Employee   Employee[]
+}
+
+model Post {
+  authorId  Int?
+  content   String?
+  id        Int     @default(autoincrement()) @id
+  published Boolean @default(false)
+  title     String
+  author    User?   @relation(fields: [authorId], references: [id])
+}
+
+enum UserType {
+  ADMIN
+  USER
+  GUEST
+}
+
+enum Day {
+  MONDAY
+  TUESDAY
+  WEDNESDAY
+  THURSDAY
+  FRIDAY
+  SATURDAY
+  SUNDAY
+}
```


