# Migration `20200919131830-branches-and-services-to-category`

This migration has been generated by Ignacio Carlos Monzalvo Milan at 9/19/2020, 1:18:30 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_BranchToCategory" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."Service" ADD COLUMN "categoryId" text   ;

CREATE UNIQUE INDEX "_BranchToCategory_AB_unique" ON "public"."_BranchToCategory"("A","B")

CREATE  INDEX "_BranchToCategory_B_index" ON "public"."_BranchToCategory"("B")

ALTER TABLE "public"."_BranchToCategory" ADD FOREIGN KEY ("A")REFERENCES "public"."Branch"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_BranchToCategory" ADD FOREIGN KEY ("B")REFERENCES "public"."Category"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Service" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."Category"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200919124830-categories-for-business..20200919131830-branches-and-services-to-category
--- datamodel.dml
+++ datamodel.dml
@@ -6,9 +6,9 @@
 }
 datasource db {
   provider = "postgres"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model AvailabilityItem {
   id         String   @default(cuid()) @id
@@ -75,8 +75,10 @@
   branches    Branch[]
   description String
   employees   Employee[]
   bookings    Booking[]
+  Category    Category?  @relation(fields: [categoryId], references: [id])
+  categoryId  String?
 }
 model Branch {
   id          String     @default(cuid()) @id
@@ -90,15 +92,18 @@
   businessId  String
   employees   Employee[]
   services    Service[]
   bookings    Booking[]
+  Category    Category[]
 }
 model Category {
   id         String    @default(cuid()) @id
   name       String
   Business   Business? @relation(fields: [businessId], references: [id])
   businessId String?
+  services   Service[]
+  branches   Branch[]
 }
 model Business {
   id           String       @default(cuid()) @id
```


